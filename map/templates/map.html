{% extends 'base.html' %}
{% load static %}

{% block title %}Landmarks Map{% endblock %}

{% block content %}
    <br>
    <h1 class="text-center my-4">Landmarks Map</h1>

    <form method="GET" action="{% url 'map' %}" class="container">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="city">Choose City:</label>
                    <select name="city" id="city" class="form-control">
                        <option value="None">ALL CITIES</option>
                        {% for city in cities %}
                            <option value="{{ city.id }}" {% if selected_city|stringformat:"s" == city.id|stringformat:"s" %}selected{% endif %}>{{ city.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label for="category">Choose Category:</label>
                    <select name="category" id="category" class="form-control">
                        <option value="None">ALL</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if selected_category|stringformat:"s" == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="col-md-4 text-center">
                <button type="submit" class="btn btn-primary mt-4">SEARCH</button>
            </div>
        </div>
    </form>
    <br>
    <div id="map" style="height: 500px; width: 100%; border-radius: 8px; overflow: hidden;"></div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmeFU3Gf6Mu9ZafPaqVVJWjQ0FrDMFilk&callback=initMap" async defer></script>

    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 7,
                center: { lat: 40.4093, lng: 49.8671 },  // Center of the map (can be changed)
                minZoom: 5     // Set the minimum zoom level
            });
    
            // Define relaxed bounds around Azerbaijan
            var bounds = new google.maps.LatLngBounds(
                new google.maps.LatLng(38.0, 44.0),  // Southwest corner (adjusted)
                new google.maps.LatLng(42.0, 51.0)   // Northeast corner (adjusted)
            );
    
            // Fit the map to the bounds
            map.fitBounds(bounds);
    
            // Prevent panning outside the bounds
            map.setOptions({
                restriction: {
                    latLngBounds: bounds,
                    strictBounds: false  // Set to false to allow a bit of wiggle room
                }
            });
    
            // Add markers for each landmark
            {% for landmark in landmarks %}
                var landmarkLocation = { lat: {{ landmark.latitude }}, lng: {{ landmark.longitude }} };  // Use your latitude and longitude fields
                var marker = new google.maps.Marker({
                    position: landmarkLocation,
                    map: map,
                    title: '{{ landmark.name }}'  // Use landmark name as marker title
                });
            {% endfor %}
        }
    </script>

    <br>
    <br>
{% endblock %}